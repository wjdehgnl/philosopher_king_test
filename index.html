<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성향테스트 - 철인/수호자/시민의눈</title>
    <style>
        /* 기본 설정 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SUIT Variable', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 390px;
            min-height: 844px;
            height: 844px;
            background-color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .screen {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
        }

        /* 홈 화면 */
        .home-screen {
            display: flex;
        }

        .logo {
            margin-bottom: 40px;
            text-align: center;
        }

        .logo h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }

        .logo p {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .cards-container {
            width: 300px;
            height: 200px;
            margin: 0 auto 40px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .role-card {
            width: 80px;
            height: 120px;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            position: absolute;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .role-card.philosopher {
            left: 20px;
            transform: rotate(-15deg);
            z-index: 3;
        }

        .role-card.guardian {
            left: 50%;
            transform: translateX(-50%) rotate(0deg);
            z-index: 2;
        }

        .role-card.citizen {
            right: 20px;
            transform: rotate(15deg);
            z-index: 1;
        }

        .card-corner-top {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
        }

        .card-corner-bottom {
            position: absolute;
            bottom: 8px;
            right: 8px;
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
            transform: rotate(180deg);
        }

        .card-image {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 8px;
        }

        .philosopher .card-corner-top,
        .philosopher .card-corner-bottom {
            color: #8B4513;
        }

        .guardian .card-corner-top,
        .guardian .card-corner-bottom {
            color: #4169E1;
        }

        .citizen .card-corner-top,
        .citizen .card-corner-bottom {
            color: #DAA520;
        }

        .start-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-primary {
            background-color: #d30000;
            color: white;
        }

        .btn-primary:hover {
            background-color: #b50000;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: white;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background-color: #f8f8f8;
        }

        /* 닉네임생성 화면 */
        .nickname-screen {
            display: none;
            padding: 40px 25px 0px 25px;
            text-align: center;
            position: relative;
            height: 100vh;
        }

        .nickname-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-bottom: 80px;
        }

        .contract-title {
            font-size: 24px;
            font-weight: 700;
            color: #d30000;
            margin-bottom: 40px;
        }

        .contract-paragraph {
            font-size: 16px;
            line-height: 1.6;
            color: #444;
            margin-bottom: 25px;
            text-align: center;
            max-width: 320px;
        }

        .signature-label {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            margin-top: 30px;
        }

        .nickname-input {
            width: 100%;
            max-width: 280px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            margin-bottom: 8px;
            transition: border-color 0.3s ease;
        }

        .nickname-input:focus {
            outline: none;
            border-color: #d30000;
        }

        .nickname-input::placeholder {
            color: #999;
            font-weight: 400;
        }

        .char-counter {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }

        .start-with-nickname-btn {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 0;
            font-size: 18px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #ccc;
            pointer-events: none;
            z-index: 1001;
        }

        .start-with-nickname-btn.active {
            background-color: #d30000;
            pointer-events: auto;
        }

        .start-with-nickname-btn.active:hover {
            background-color: #b50000;
        }

        /* 테스트 화면 */
        .test-screen {
            display: none;
            padding: 40px 20px 20px 20px;
        }

        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 50px;
            background-color: #e0e0e0;
            border-radius: 0;
            margin-bottom: 0;
            overflow: hidden;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d30000, #FF3C43, #FF7719);
            border-radius: 0;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            display: none;
        }

        .question-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .question-number {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            line-height: 1.4;
            margin-bottom: 25px;
        }

        .options-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        /* 수정된 선택지 버튼 스타일 */
        .option-btn {
            border: 2px solid #000;
            border-radius: 50%;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #999;
        }

        /* 가장 바깥쪽 (1,6번) - 48px */
        .option-btn[data-value="1"], 
        .option-btn[data-value="6"] {
            width: 48px;
            height: 48px;
        }

        /* 나머지 (2,3,4,5번) - 40px 통일 */
        .option-btn[data-value="2"], 
        .option-btn[data-value="3"],
        .option-btn[data-value="4"],
        .option-btn[data-value="5"] {
            width: 40px;
            height: 40px;
        }

        .option-btn:hover {
            border-color: #d30000;
            transform: scale(1.05);
        }

        /* 선택된 상태 색깔 변경 - 검정색으로 */
        .option-btn.selected {
            background-color: #000;
            border-color: #000;
            color: white;
        }

        .option-labels {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            margin-bottom: 0px;
            font-size: 12px;
            color: #666;
            padding: 0 4px;
        }

        .questions-container {
            max-height: 75vh;
            overflow-y: auto;
            padding: 0px 20px 80px 20px; /* 하단 패딩 80px로 증가 */
            width: 100%;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .questions-container::-webkit-scrollbar {
            display: none;
        }

        .question-item {
            margin-bottom: 35px;
            opacity: 1;
            transition: all 0.5s ease;
        }

        .question-item:first-child {
            margin-top: 20px;
        }

        .question-item:last-child {
            margin-bottom: 10px;
        }

        .question-item.answered {
            opacity: 0.6;
        }

        /* 결과 화면 - 수정됨 */
        .result-screen {
            display: none;
            padding: 20px;
            text-align: center;
        }

        .result-subtitle {
            font-size: 16px;
            font-weight: 500;
            color: #666;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: 32px;
            font-weight: 700;
            color: #d30000;
            margin-bottom: 40px;
        }

        /* 막대그래프 컨테이너 */
        .bar-chart-container {
            width: 100%;
            max-width: 320px;
            margin: 0 auto 30px;
        }

        .bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 12px;
        }

        .bar-label {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            width: 60px;
            text-align: right;
        }

        .bar-label.highlighted {
            font-weight: 700;
            color: #d30000;
        }

        .bar-container {
            flex: 1;
            height: 24px;
            background-color: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background-color: #ccc;
            border-radius: 12px;
            transition: width 1s ease-out;
            width: 0%;
        }

        .bar-fill.highlighted {
            background: linear-gradient(90deg, #d30000, #FF3C43);
        }

        .bar-score {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            width: 30px;
            text-align: left;
        }

        .bar-score.highlighted {
            font-weight: 700;
            color: #d30000;
        }

        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 30px;
        }

        /* 숨김/표시 클래스 */
        .hidden { 
            display: none !important; 
            visibility: hidden;
            opacity: 0;
        }
        .show { 
            display: flex !important; 
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 홈 화면 -->
        <div class="screen home-screen" id="homeScreen">
            <div class="logo">
                <h1>POLITICAL ROLE TEST</h1>
                <p>나의 정치역할은 무엇일까?</p>
            </div>
            
            <div class="cards-container">
                <!-- 철인 카드 (P) -->
                <div class="role-card philosopher">
                    <div class="card-corner-top">P</div>
                    <div class="card-image">
                        <svg width="50" height="60" viewBox="0 0 50 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- 철학자 얼굴 -->
                            <circle cx="25" cy="20" r="12" fill="#F4C2A1" stroke="#8B4513" stroke-width="1"/>
                            <!-- 수염 -->
                            <path d="M15 25 Q25 35 35 25" fill="none" stroke="#8B4513" stroke-width="2"/>
                            <path d="M17 28 Q25 36 33 28" fill="none" stroke="#8B4513" stroke-width="1.5"/>
                            <!-- 눈 -->
                            <circle cx="21" cy="18" r="1.5" fill="#333"/>
                            <circle cx="29" cy="18" r="1.5" fill="#333"/>
                            <!-- 모자/월계관 -->
                            <ellipse cx="25" cy="12" rx="14" ry="4" fill="none" stroke="#DAA520" stroke-width="2"/>
                            <!-- 하단 대칭 이미지 -->
                            <g transform="translate(25,45) rotate(180) translate(-25,-15)">
                                <circle cx="25" cy="20" r="12" fill="#F4C2A1" stroke="#8B4513" stroke-width="1"/>
                                <path d="M15 25 Q25 35 35 25" fill="none" stroke="#8B4513" stroke-width="2"/>
                                <circle cx="21" cy="18" r="1.5" fill="#333"/>
                                <circle cx="29" cy="18" r="1.5" fill="#333"/>
                                <ellipse cx="25" cy="12" rx="14" ry="4" fill="none" stroke="#DAA520" stroke-width="2"/>
                            </g>
                        </svg>
                    </div>
                    <div class="card-corner-bottom">P</div>
                </div>
                
                <!-- 수호자 카드 (G) -->
                <div class="role-card guardian">
                    <div class="card-corner-top">G</div>
                    <div class="card-image">
                        <svg width="50" height="60" viewBox="0 0 50 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- 방패 -->
                            <path d="M25 5 L35 10 L35 25 Q35 35 25 40 Q15 35 15 25 L15 10 Z" fill="#4169E1" stroke="#000" stroke-width="1.5"/>
                            <!-- 방패 장식 -->
                            <path d="M25 8 L32 12 L32 24 Q32 32 25 36 Q18 32 18 24 L18 12 Z" fill="#87CEEB"/>
                            <!-- 검 -->
                            <rect x="24" y="15" width="2" height="15" fill="#C0C0C0"/>
                            <rect x="22" y="15" width="6" height="3" fill="#DAA520"/>
                            <!-- 하단 대칭 이미지 -->
                            <g transform="translate(25,45) rotate(180) translate(-25,-15)">
                                <path d="M25 5 L35 10 L35 25 Q35 35 25 40 Q15 35 15 25 L15 10 Z" fill="#4169E1" stroke="#000" stroke-width="1.5"/>
                                <path d="M25 8 L32 12 L32 24 Q32 32 25 36 Q18 32 18 24 L18 12 Z" fill="#87CEEB"/>
                                <rect x="24" y="15" width="2" height="15" fill="#C0C0C0"/>
                                <rect x="22" y="15" width="6" height="3" fill="#DAA520"/>
                            </g>
                        </svg>
                    </div>
                    <div class="card-corner-bottom">G</div>
                </div>
                
                <!-- 시민의눈 카드 (C) -->
                <div class="role-card citizen">
                    <div class="card-corner-top">C</div>
                    <div class="card-image">
                        <svg width="50" height="60" viewBox="0 0 50 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- 이집트 눈 (호루스의 눈) -->
                            <ellipse cx="25" cy="20" rx="15" ry="8" fill="white" stroke="#DAA520" stroke-width="2"/>
                            <!-- 눈동자 -->
                            <circle cx="25" cy="20" r="5" fill="#4169E1"/>
                            <circle cx="25" cy="20" r="2" fill="#000"/>
                            <!-- 눈 장식 (이집트 스타일) -->
                            <path d="M10 20 Q15 25 20 20" fill="none" stroke="#DAA520" stroke-width="2"/>
                            <path d="M30 20 Q35 25 40 20" fill="none" stroke="#DAA520" stroke-width="2"/>
                            <path d="M25 28 L25 32" stroke="#DAA520" stroke-width="2"/>
                            <!-- 하단 대칭 이미지 -->
                            <g transform="translate(25,45) rotate(180) translate(-25,-15)">
                                <ellipse cx="25" cy="20" rx="15" ry="8" fill="white" stroke="#DAA520" stroke-width="2"/>
                                <circle cx="25" cy="20" r="5" fill="#4169E1"/>
                                <circle cx="25" cy="20" r="2" fill="#000"/>
                                <path d="M10 20 Q15 25 20 20" fill="none" stroke="#DAA520" stroke-width="2"/>
                                <path d="M30 20 Q35 25 40 20" fill="none" stroke="#DAA520" stroke-width="2"/>
                                <path d="M25 28 L25 32" stroke="#DAA520" stroke-width="2"/>
                            </g>
                        </svg>
                    </div>
                    <div class="card-corner-bottom">C</div>
                </div>
            </div>
            
            <div class="start-buttons">
                <button class="btn btn-primary" onclick="startTest()">테스트 시작하기</button>
                <button class="btn btn-primary" onclick="showRandomResult()" style="background-color: #FF7719;">결과테스트</button>
                <button class="btn btn-secondary" onclick="shareKakaoTalk()">카카오톡 공유하기</button>
                <button class="btn btn-secondary" onclick="shareLink()">링크 공유하기</button>
            </div>
        </div>

        <!-- 닉네임생성 화면 -->
        <div class="screen nickname-screen" id="nicknameScreen">
            <div class="nickname-content">
                <div class="contract-title">당신의 정치역할은?</div>
                
                <div class="contract-paragraph">
                    본 테스트는 넷플릭스 오리지널 프로그램 내에서 활용하기 위해 제작된 척도로, 측정값이 응답자의 견해와 일부 일치하지 않을 수 있습니다.
                </div>
                
                <div class="contract-paragraph">
                    현재는 테스트 단계이므로 질문 및 사용자환경이 얼마든지 수정될 수 있습니다.
                </div>
                
                <div class="signature-label">닉네임을 입력해주세요</div>
                <input type="text" 
                       class="nickname-input" 
                       id="nicknameInput" 
                       placeholder="닉네임 (2~8글자)"
                       maxlength="8">
                <div class="char-counter" id="charCounter">0 / 8</div>
            </div>
            
            <button class="start-with-nickname-btn" id="startWithNicknameBtn">
                닉네임 입력하고 시작하기
            </button>
        </div>

        <!-- 테스트 화면 -->
        <div class="screen test-screen" id="testScreen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">1 / 48</div>
            
            <div class="questions-container" id="questionsContainer">
                <!-- 질문들이 동적으로 추가됩니다 -->
            </div>
        </div>

        <!-- 결과 화면 - 수정됨 -->
        <div class="screen result-screen" id="resultScreen">
            <div class="result-subtitle">당신의 정치역할은</div>
            <div class="result-title" id="resultTitle">철인</div>
            
            <div class="bar-chart-container" id="barChart">
                <!-- 막대그래프가 동적으로 생성됩니다 -->
            </div>
            
            <div class="share-buttons">
                <button class="btn btn-primary" onclick="restartTest()">다시 테스트하기</button>
                <button class="btn btn-secondary" onclick="shareKakaoTalk()">카카오톡 공유하기</button>
                <button class="btn btn-secondary" onclick="shareLink()">링크 공유하기</button>
            </div>
        </div>
    </div>

    <script>
        // 테스트 설정 - 새로운 3개 지수 체계 (240문항 중 일부만 표시)
        const testConfig = {
            questions: [
                // 철인지수 (indexType: 0) - 도덕심 파트 샘플
                { text: "선배의 잘못을 보고도 침묵하며 넘어가는 것이 현명하다고 생각한다.", indexType: 0, partIndex: 0, isReverse: true },
                { text: "내가 하는 일에서 신념과 원칙은 타협할 수 없는 부분이다.", indexType: 0, partIndex: 0, isReverse: false },
                { text: "법적으로는 문제가 없어도 도덕적으로 옳지 않다면 하지 않는다.", indexType: 0, partIndex: 0, isReverse: false },
                { text: "다수를 위해서는 소수의 희생이 불가피한 경우가 있다고 생각한다.", indexType: 0, partIndex: 0, isReverse: true },
                { text: "올바른 일이라고 판단되면 혼자서라도 행동에 나선다.", indexType: 0, partIndex: 0, isReverse: false },
                
                // 철인지수 - 적시판단 파트 샘플  
                { text: "상황에 따라 융통성 있게 행동하는 것이 중요하다.", indexType: 0, partIndex: 1, isReverse: true },
                { text: "매사에 신중하게 고민하고 결정하는 편이다.", indexType: 0, partIndex: 1, isReverse: false },
                { text: "복잡한 상황에서는 빠른 결정보다는 충분한 검토가 필요하다.", indexType: 0, partIndex: 1, isReverse: true },
                { text: "위기상황에서는 직감적 판단이 더 효과적이다.", indexType: 0, partIndex: 1, isReverse: true },
                { text: "새로운 정보가 생기면 기존 판단을 번복할 수 있다.", indexType: 0, partIndex: 1, isReverse: false },
                
                // 철인지수 - 호불호범위 파트 샘플
                { text: "나는 호불호가 분명한 편이다.", indexType: 0, partIndex: 2, isReverse: true },
                { text: "내 취향과 다른 것들도 인정하고 받아들인다.", indexType: 0, partIndex: 2, isReverse: false },
                { text: "좋아하는 것과 싫어하는 것의 구분이 명확하다.", indexType: 0, partIndex: 2, isReverse: true },
                { text: "다른 사람의 취향을 존중하려고 노력한다.", indexType: 0, partIndex: 2, isReverse: false },
                { text: "내가 싫어하는 것은 분명히 표현한다.", indexType: 0, partIndex: 2, isReverse: true },
                
                // 철인지수 - K-리더십 파트 샘플
                { text: "그룹에서 자연스럽게 리더 역할을 맡게 된다.", indexType: 0, partIndex: 3, isReverse: false },
                { text: "다른 사람들의 의견을 먼저 들어보는 편이다.", indexType: 0, partIndex: 3, isReverse: true },
                { text: "내가 앞장서서 일을 추진하는 것을 좋아한다.", indexType: 0, partIndex: 3, isReverse: false },
                { text: "팀워크를 중시하고 협력을 이끌어낸다.", indexType: 0, partIndex: 3, isReverse: false },
                { text: "결정권이 있을 때 책임감을 느끼고 신중하게 결정한다.", indexType: 0, partIndex: 3, isReverse: false },

                // 수호자지수 (indexType: 1) - 충성 파트 샘플
                { text: "국가는 개인의 자유를 제한할 수 있다.", indexType: 1, partIndex: 0, isReverse: false },
                { text: "상관의 명령은 불합리해도 따라야 한다.", indexType: 1, partIndex: 0, isReverse: true },
                { text: "조직의 결정을 따르는 것이 중요하다.", indexType: 1, partIndex: 0, isReverse: true },
                { text: "나는 공동체의 규율을 충실히 지킨다.", indexType: 1, partIndex: 0, isReverse: false },
                { text: "지도자에 대한 충성심이 공동체를 지탱한다.", indexType: 1, partIndex: 0, isReverse: false },
                
                // 수호자지수 - 질서 파트 샘플
                { text: "법과 규칙은 엄격히 지켜져야 한다.", indexType: 1, partIndex: 1, isReverse: false },
                { text: "질서를 어지럽히는 행위는 제재해야 한다.", indexType: 1, partIndex: 1, isReverse: true },
                { text: "규율 없는 자유는 혼란을 낳는다.", indexType: 1, partIndex: 1, isReverse: false },
                { text: "법은 개인보다 우선한다.", indexType: 1, partIndex: 1, isReverse: true },
                { text: "무질서는 공동체를 붕괴시킨다.", indexType: 1, partIndex: 1, isReverse: false },
                
                // 수호자지수 - 책임 파트 샘플
                { text: "공동체의 이익을 위해 개인적 욕구를 희생할 수 있다.", indexType: 1, partIndex: 2, isReverse: false },
                { text: "책임은 피하지 않고 감당해야 한다.", indexType: 1, partIndex: 2, isReverse: false },
                { text: "내가 맡은 역할을 끝까지 수행한다.", indexType: 1, partIndex: 2, isReverse: true },
                { text: "나는 임무에 책임감을 느낀다.", indexType: 1, partIndex: 2, isReverse: false },
                { text: "공동체의 성공은 모두의 책임이다.", indexType: 1, partIndex: 2, isReverse: false },
                
                // 수호자지수 - 보호 파트 샘플
                { text: "공동체를 지키는 것이 개인보다 우선이다.", indexType: 1, partIndex: 3, isReverse: false },
                { text: "나는 위협이 있으면 공동체를 보호한다.", indexType: 1, partIndex: 3, isReverse: true },
                { text: "외부의 위험으로부터 방어가 필요하다.", indexType: 1, partIndex: 3, isReverse: false },
                { text: "나는 위기에 공동체를 위해 싸운다.", indexType: 1, partIndex: 3, isReverse: true },
                { text: "안전을 위해 희생할 준비가 되어 있다.", indexType: 1, partIndex: 3, isReverse: false },

                // 시민의 눈지수 (indexType: 2) - 감시 파트 샘플
                { text: "권력자는 항상 감시받아야 한다.", indexType: 2, partIndex: 0, isReverse: false },
                { text: "언론의 자유로운 감시는 민주주의의 핵심이다.", indexType: 2, partIndex: 0, isReverse: false },
                { text: "권력자는 시민의 눈을 두려워해야 한다.", indexType: 2, partIndex: 0, isReverse: false },
                { text: "나는 지도자의 행동을 비판적으로 본다.", indexType: 2, partIndex: 0, isReverse: false },
                { text: "감시 없이는 부패가 생긴다.", indexType: 2, partIndex: 0, isReverse: false },
                
                // 시민의 눈지수 - 참여 파트 샘플
                { text: "시민은 정치 과정에 적극 참여해야 한다.", indexType: 2, partIndex: 1, isReverse: false },
                { text: "투표는 최소한의 참여다.", indexType: 2, partIndex: 1, isReverse: true },
                { text: "사회문제 참여는 중요하다.", indexType: 2, partIndex: 1, isReverse: false },
                { text: "참여 없이는 정치가 변하지 않는다.", indexType: 2, partIndex: 1, isReverse: false },
                { text: "참여는 책임 있는 시민의 자세다.", indexType: 2, partIndex: 1, isReverse: false },
                
                // 시민의 눈지수 - 비판 파트 샘플
                { text: "나는 권력자의 정책을 비판적으로 본다.", indexType: 2, partIndex: 2, isReverse: false },
                { text: "비판은 민주주의를 지탱한다.", indexType: 2, partIndex: 2, isReverse: false },
                { text: "비판 없는 사회는 발전할 수 없다.", indexType: 2, partIndex: 2, isReverse: true },
                { text: "나는 잘못된 정책을 비판한다.", indexType: 2, partIndex: 2, isReverse: false },
                { text: "비판은 책임을 묻는 과정이다.", indexType: 2, partIndex: 2, isReverse: false },
                
                // 시민의 눈지수 - 다양성존중 파트 샘플
                { text: "다양한 의견은 존중되어야 한다.", indexType: 2, partIndex: 3, isReverse: false },
                { text: "나는 다른 문화와 가치를 존중한다.", indexType: 2, partIndex: 3, isReverse: false },
                { text: "사회는 다양성을 통해 발전한다.", indexType: 2, partIndex: 3, isReverse: false },
                { text: "나는 나와 다른 의견을 수용한다.", indexType: 2, partIndex: 3, isReverse: false },
                { text: "다양성은 민주주의의 힘이다.", indexType: 2, partIndex: 3, isReverse: false }
            ],
            
            indices: [
                { 
                    name: "철인", 
                    parts: ["도덕심", "적시판단", "호불호범위", "K-리더십"] 
                },
                { 
                    name: "수호자", 
                    parts: ["충성", "질서", "책임", "보호"] 
                },
                { 
                    name: "시민의눈", 
                    parts: ["감시", "참여", "비판", "다양성존중"] 
                }
            ]
        };

        // 질문을 간단한 알고리즘으로 섞기
        function shuffleQuestions(questions) {
            const shuffled = [...questions];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // 각 지수별로 파트당 4문항씩 선택하여 총 48개 질문 구성
        function selectQuestionsForTest() {
            const selectedQuestions = [];
            
            // 3개 지수(indexType: 0,1,2) × 4개 파트 × 4문항씩 = 48문항
            for (let indexType = 0; indexType < 3; indexType++) {
                for (let partIndex = 0; partIndex < 4; partIndex++) {
                    // 해당 지수의 해당 파트 문항들 필터링
                    const partQuestions = testConfig.questions.filter(q => 
                        q.indexType === indexType && q.partIndex === partIndex
                    );
                    
                    // 파트별 문항들 섞기 후 4개 선택
                    const shuffledPart = shuffleQuestions(partQuestions);
                    const selectedPart = shuffledPart.slice(0, 4);
                    
                    selectedQuestions.push(...selectedPart);
                }
            }
            
            // 선택된 48개 질문을 다시 완전 랜덤으로 섞기
            return shuffleQuestions(selectedQuestions);
        }

        // 테스트용 질문 리스트 생성
        let testQuestions = selectQuestionsForTest();

        // 테스트 상태
        let currentQuestion = 0;
        let answers = [];
        let scores = [0, 0, 0]; // 3개 지수별 점수 (철인, 수호자, 시민의눈)
        let userNickname = ''; // 사용자 닉네임

        // 화면 전환 유틸리티 함수
        function switchScreen(targetScreenId) {
            const allScreens = ['homeScreen', 'nicknameScreen', 'testScreen', 'resultScreen'];
            
            allScreens.forEach(screenId => {
                const screen = document.getElementById(screenId);
                screen.classList.remove('show');
                screen.classList.add('hidden');
            });
            
            const targetScreen = document.getElementById(targetScreenId);
            targetScreen.classList.remove('hidden');
            targetScreen.classList.add('show');
            
            // 스크롤 위치 초기화
            window.scrollTo(0, 0);
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
            
            const questionsContainer = document.getElementById('questionsContainer');
            if (questionsContainer) {
                questionsContainer.scrollTop = 0;
            }
        }

        // 닉네임 입력 관련 함수들
        function initializeNicknameScreen() {
            const nicknameInput = document.getElementById('nicknameInput');
            const charCounter = document.getElementById('charCounter');
            const startBtn = document.getElementById('startWithNicknameBtn');
            
            // 닉네임 입력 이벤트
            nicknameInput.addEventListener('input', function() {
                let value = this.value;
                
                // 8글자 제한
                if (value.length > 8) {
                    value = value.substring(0, 8);
                    this.value = value;
                }
                
                // 글자수 표시
                charCounter.textContent = `${value.length} / 8`;
                
                // 버튼 활성화 조건 체크 (2글자 이상)
                if (value.length >= 2) {
                    startBtn.classList.add('active');
                } else {
                    startBtn.classList.remove('active');
                }
            });
            
            // 닉네임 입력 완료 버튼
            startBtn.addEventListener('click', function() {
                const nickname = nicknameInput.value.trim();
                if (nickname.length >= 2) {
                    userNickname = nickname;
                    switchScreen('testScreen');
                    showNextQuestion();
                }
            });
            
            // Enter 키로도 진행 가능
            nicknameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim().length >= 2) {
                    startBtn.click();
                }
            });
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeNicknameScreen();
        });

        // 막대그래프 업데이트 함수
        function updateBarChart(scores) {
            const roleNames = ['철인', '수호자', '시민의눈'];
            const displayScores = scores.map(score => score + 4); // +4점 추가
            
            // 점수와 인덱스를 함께 묶어서 정렬 (높은 점수부터)
            const sortedData = displayScores.map((score, index) => ({
                score: score,
                name: roleNames[index],
                originalIndex: index
            })).sort((a, b) => b.score - a.score);
            
            const maxIndex = sortedData[0].originalIndex;
            
            // 제목 업데이트 (닉네임 반영)
            let displayName;
            if (userNickname) {
                displayName = `${userNickname}님`;
            } else {
                displayName = '당신';
            }
            document.getElementById('resultTitle').textContent = roleNames[maxIndex];
            document.querySelector('.result-subtitle').textContent = `${displayName}의 정치역할은`;
            
            // 막대그래프 HTML 동적 생성
            const barChart = document.getElementById('barChart');
            barChart.innerHTML = '';
            
            // 정렬된 순서대로 막대그래프 생성
            sortedData.forEach((data, index) => {
                const barRow = document.createElement('div');
                barRow.className = 'bar-row';
                
                const isHighest = index === 0; // 첫 번째(가장 높은 점수)인지 확인
                const barWidth = (data.score / 100) * 100; // 100점 기준 퍼센트
                
                barRow.innerHTML = `
                    <div class="bar-label ${isHighest ? 'highlighted' : ''}">${data.name}</div>
                    <div class="bar-container">
                        <div class="bar-fill ${isHighest ? 'highlighted' : ''}" style="width: 0%;"></div>
                    </div>
                    <div class="bar-score ${isHighest ? 'highlighted' : ''}">${data.score}</div>
                `;
                
                barChart.appendChild(barRow);
                
                // 애니메이션과 함께 막대 채우기
                const barFill = barRow.querySelector('.bar-fill');
                setTimeout(() => {
                    barFill.style.width = `${barWidth}%`;
                }, 300 + index * 200);
            });
        }

        // 개발용 테스트 기능
        function showRandomResult() {
            // 랜덤한 점수 생성 (16~96 범위)
            scores = [
                Math.floor(Math.random() * 81) + 16, // 철인지수
                Math.floor(Math.random() * 81) + 16, // 수호자지수
                Math.floor(Math.random() * 81) + 16  // 시민의눈지수
            ];
            
            // 결과테스트는 닉네임 없이 진행 ('당신'이 기본값)
            userNickname = '';
            
            switchScreen('resultScreen');
            updateBarChart(scores);
        }

        function startTest() {
            switchScreen('nicknameScreen');
        }

        function showNextQuestion() {
            if (currentQuestion >= testQuestions.length) {
                showResult();
                return;
            }

            const question = testQuestions[currentQuestion];
            const questionsContainer = document.getElementById('questionsContainer');
            
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item';
            questionItem.innerHTML = `
                <div class="question-container">
                    <div class="question-text">${question.text}</div>
                </div>
                
                <div class="options-container">
                    <button class="option-btn" data-value="1" data-question="${currentQuestion}"></button>
                    <button class="option-btn" data-value="2" data-question="${currentQuestion}"></button>
                    <button class="option-btn" data-value="3" data-question="${currentQuestion}"></button>
                    <button class="option-btn" data-value="4" data-question="${currentQuestion}"></button>
                    <button class="option-btn" data-value="5" data-question="${currentQuestion}"></button>
                    <button class="option-btn" data-value="6" data-question="${currentQuestion}"></button>
                </div>
                <div class="option-labels">
                    <span>매우 반대</span>
                    <span>매우 동의</span>
                </div>
            `;
            
            questionsContainer.appendChild(questionItem);
            
            const options = questionItem.querySelectorAll('.option-btn');
            options.forEach(btn => {
                btn.onclick = () => selectOption(btn);
            });

            // 진행률 표시 48개 기준으로 수정
            document.getElementById('progressText').textContent = `${currentQuestion + 1} / 48`;
            document.getElementById('progressFill').style.width = `${((currentQuestion + 1) / 48) * 100}%`;
            
            setTimeout(() => {
                questionItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function selectOption(selectedBtn) {
            const questionIndex = parseInt(selectedBtn.dataset.question);
            const value = parseInt(selectedBtn.dataset.value);
            
            const questionItem = selectedBtn.closest('.question-item');
            const allOptions = questionItem.querySelectorAll('.option-btn');
            
            allOptions.forEach(btn => {
                btn.classList.remove('selected');
                btn.style.pointerEvents = 'none';
            });
            
            selectedBtn.classList.add('selected');
            questionItem.classList.add('answered');
            
            answers[questionIndex] = value;
            
            // 새로운 점수 계산 로직
            const question = testQuestions[questionIndex];
            const actualScore = question.isReverse ? (7 - value) : value;
            scores[question.indexType] += actualScore;
            
            currentQuestion++;
            
            setTimeout(() => {
                showNextQuestion();
            }, 100);
        }

        function showResult() {
            switchScreen('resultScreen');
            updateBarChart(scores);
        }

        function restartTest() {
            currentQuestion = 0;
            answers = [];
            scores = [0, 0, 0];
            userNickname = '';
            testQuestions = selectQuestionsForTest();
            
            // 닉네임 입력란 초기화
            const nicknameInput = document.getElementById('nicknameInput');
            const charCounter = document.getElementById('charCounter');
            const startBtn = document.getElementById('startWithNicknameBtn');
            
            nicknameInput.value = '';
            charCounter.textContent = '0 / 8';
            startBtn.classList.remove('active');
            
            // 테스트 화면 초기화
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('progressText').textContent = '1 / 48';
            document.getElementById('progressFill').style.width = '0%';
            
            switchScreen('homeScreen');
        }

        function shareKakaoTalk() {
            const roleNames = ['철인', '수호자', '시민의눈'];
            const displayScores = scores.map(score => score + 4);
            const maxIndex = displayScores.indexOf(Math.max(...displayScores));
            alert(`카카오톡 공유 기능 (결과: ${roleNames[maxIndex]})\n실제 구현 시 카카오 SDK를 사용하세요.`);
        }

        function shareLink() {
            if (navigator.share) {
                navigator.share({
                    title: '성향테스트 - 철인/수호자/시민의눈',
                    text: '나의 정치역할을 확인해보세요!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('링크가 복사되었습니다!');
                });
            }
        }
    </script>
</body>
</html>
